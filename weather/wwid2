import pandas as pd
import numpy as np

def calculate_categorical_psi(expected, actual):
    # 1. Get percentage distributions
    expected_perc = expected.value_counts(normalize=True)
    actual_perc = actual.value_counts(normalize=True)

    # 2. Align categories and handle zeros
    df = pd.DataFrame({'expected': expected_perc, 'actual': actual_perc}).fillna(0.0001)

    # 3. Calculate PSI
    psi_value = np.sum((df['actual'] - df['expected']) * np.log(df['actual'] / df['expected']))

    # 4. Interpret the result
    if psi_value < 0.10:
        interpretation = "Insignificant change"
    elif 0.10 <= psi_value < 0.25:
        interpretation = "Minor shift; monitor closely"
    else:
        interpretation = "Significant shift; action required"

    return psi_value, interpretation

# --- Usage ---
psi, status = calculate_categorical_psi(base_series, new_series)
print(f"PSI: {psi:.4f} | Status: {status}")
