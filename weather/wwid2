Sub ExportTableCaptionsToCSV()
    Dim tbl As Table
    Dim para As Paragraph
    Dim fullText As String
    Dim tableName As String
    Dim caption As String
    Dim tableNum As Integer
    Dim outputPath As String
    Dim fso As Object
    Dim txtStream As Object
    Dim colonPos As Integer
    
    ' Set output file path (same folder as document)
    outputPath = ThisDocument.Path & "\table_captions.csv"
    
    ' Create FileSystemObject
    Set fso = CreateObject("Scripting.FileSystemObject")
    Set txtStream = fso.CreateTextFile(outputPath, True)
    
    ' Write CSV header
    txtStream.WriteLine "Table_Number,Caption"
    
    tableNum = 1
    
    ' Loop through all tables
    For Each tbl In ActiveDocument.Tables
        fullText = ""
        tableName = ""
        caption = ""
        
        ' Try to find caption (usually the paragraph before the table)
        On Error Resume Next
        fullText = tbl.Range.Paragraphs(1).Previous.Range.Text
        On Error GoTo 0
        
        If fullText <> "" Then
            fullText = Replace(fullText, vbCr, "")
            fullText = Replace(fullText, vbLf, "")
            fullText = Trim(fullText)
            
            ' Find the colon and split
            colonPos = InStr(fullText, ":")
            If colonPos > 0 Then
                tableName = Trim(Left(fullText, colonPos - 1))
                caption = Trim(Mid(fullText, colonPos + 1))
            Else
                ' No colon found, use full text as caption
                caption = fullText
            End If
        End If
        
        ' Escape quotes for CSV
        tableName = Replace(tableName, """", """""")
        caption = Replace(caption, """", """""")
        
        ' Write to CSV with quotes around both fields
        txtStream.WriteLine """" & tableName & """,""" & caption & """"
        
        tableNum = tableNum + 1
    Next tbl
    
    txtStream.Close
    
    MsgBox "Exported " & (tableNum - 1) & " tables to:" & vbCrLf & outputPath, vbInformation
    
End Sub
