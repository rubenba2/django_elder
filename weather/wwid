Sub SplitDataIntoSheets()
    Dim ws As Worksheet, newWs As Worksheet
    Dim colasdfCol As Range, cell As Range
    Dim uniqueValues As Object
    Dim lastRow As Long, headerRow As Range
    Dim targetSheetName As String
    Dim invalidChars As Variant
    Dim i As Integer
    
    ' Set the source worksheet (change as needed)
    Set ws = ThisWorkbook.Sheets("Sheet1") ' Change "Sheet1" if needed
    
    ' Find the last row of data
    lastRow = ws.Cells(ws.Rows.Count, "AP").End(xlUp).Row
    
    ' Set the column with "colasdf" (now column AP)
    Set colasdfCol = ws.Range("AP2:AP" & lastRow) ' "colasdf" is now in column AP
    
    ' Create a dictionary to store unique values
    Set uniqueValues = CreateObject("Scripting.Dictionary")
    
    ' Identify unique values in "colasdf" column
    For Each cell In colasdfCol
        If Not uniqueValues.exists(cell.Value) And cell.Value <> "" Then
            uniqueValues.Add cell.Value, Nothing
        End If
    Next cell
    
    ' Copy header row
    Set headerRow = ws.Rows(1)
    
    ' List of invalid characters for sheet names
    invalidChars = Array("\", "/", "*", "[", "]", ":", "?")
    
    ' Loop through unique values and create separate sheets
    For Each targetSheetName In uniqueValues.Keys
        ' Remove invalid characters and truncate to 31 characters
        For i = LBound(invalidChars) To UBound(invalidChars)
            targetSheetName = Replace(targetSheetName, invalidChars(i), "")
        Next i
        If Len(targetSheetName) > 31 Then
            targetSheetName = Left(targetSheetName, 31)
        End If
        
        ' Create new sheet
        On Error Resume Next
        Set newWs = ThisWorkbook.Sheets(targetSheetName)
        If newWs Is Nothing Then
            Set newWs = ThisWorkbook.Sheets.Add
            newWs.Name = targetSheetName
        End If
        On Error GoTo 0
        
        ' Copy header to new sheet
        headerRow.Copy Destination:=newWs.Rows(1)
        
        ' Copy rows matching the current value
        ws.Range("AP1").CurrentRegion.AutoFilter Field:=42, Criteria1:=targetSheetName
        ws.UsedRange.SpecialCells(xlCellTypeVisible).Copy Destination:=newWs.Range("A2")
        ws.AutoFilterMode = False
    Next targetSheetName
    
    MsgBox "Data has been split into separate sheets!", vbInformation
End Sub
