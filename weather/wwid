# Group by rating and calculate calibration stats
calibration_summary = cohort_data.groupby('proposed_final_crr').agg(
    obligors=('proposed_final_pd', 'count'),
    avg_pd=('proposed_final_pd', 'mean'),
    defaults=('DEFAULT_EVENT', 'sum')
)

# Calculate observed default rate
calibration_summary['odr'] = calibration_summary['defaults'] / calibration_summary['obligors']

# Optional: round for cleaner display
calibration_summary = calibration_summary.round({'avg_pd': 4, 'odr': 4})

# Reset index if you want a flat table
calibration_summary = calibration_summary.reset_index()

# Display the table
print(calibration_summary)
